name: Push-to-EC2

# Trigger deployment only on push to main branch
on:
  workflow_dispatch:
jobs:
  deploy:
    name: Deploy to EC2 on main branch push
    runs-on: ubuntu-latest

    steps:
    - name: Checkout the files
      uses: actions/checkout@v2
      
    - name: Remove old JAR files
      uses: appleboy/ssh-action@v1.0.2
      with:
        host: ${{ secrets.HOST_DNS }}
        username: ${{ secrets.USERNAME }}
        key: ${{ secrets.EC2_SSH_KEY }}
        script: |
          # Navigate to the application directory
          cd /home/${{ secrets.USERNAME }}/app
          
          # Remove all existing JAR files
          sudo rm -f *.jar
          echo "Old JAR files deleted."
